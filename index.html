<!doctype html>
<html lang="es">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RLQ6Y55SNC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RLQ6Y55SNC', { anonymize_ip: true });
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Calcula el castigo cal√≥rico de tu cena/noche de copas y descubre cu√°nto ejercicio tendr√≠as que hacer para sudarlo." />
  <title>LoVasASudar.com ¬∑ Calculadora de castigo cal√≥rico</title>

  <style>
    :root{
      --bg1:#050617;
      --bg2:#0b0f2a;
      --card:#0b1130cc;
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.55);
      --primary:#5b7cfa;
      --pink:#ff4fd8;
      --cyan:#38e8ff;
      --amber:#ffb648;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;
      --good:#63ffb8;
      --warn:#ffd66a;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 12% 12%, rgba(91,124,250,.25), transparent 55%),
        radial-gradient(900px 700px at 88% 18%, rgba(255,79,216,.20), transparent 55%),
        radial-gradient(900px 900px at 70% 90%, rgba(56,232,255,.14), transparent 50%),
        linear-gradient(180deg, var(--bg2), var(--bg1) 70%);
      overflow-x:hidden;
    }

    /* Fondo decorativo: no puede interceptar clics */
    .fx{
      position:fixed;
      inset:-2px;
      pointer-events:none;
      z-index:0;
      opacity:.9;
      background:
        radial-gradient(600px 900px at 100% 15%, rgba(255,180,72,.18), transparent 60%),
        radial-gradient(800px 700px at 0% 40%, rgba(56,232,255,.12), transparent 55%);
    }

    .wrap{
      position:relative;
      z-index:2;
      max-width:1150px;
      margin: 26px auto 70px;
      padding: 0 18px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:16px;
    }

    .brand-pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(10,14,40,.55);
      box-shadow: 0 10px 40px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      font-weight:800;
      letter-spacing:.2px;
    }

    /* NEON IZQUIERDO */
    .neon-sign{
      position:fixed;
      left: 16px;
      top: 150px;
      z-index:3;
      display:flex;
      align-items:center;
      justify-content:center;
      width:84px;
      padding:14px 10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(10,14,40,.55), rgba(8,10,26,.35));
      backdrop-filter: blur(10px);
      box-shadow:
        0 16px 70px rgba(0,0,0,.55),
        0 0 22px rgba(56,232,255,.18),
        0 0 38px rgba(255,79,216,.16);
    }
    .neon-sign::before{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius: 22px;
      background: conic-gradient(from 180deg,
        rgba(56,232,255,.0),
        rgba(56,232,255,.35),
        rgba(255,79,216,.30),
        rgba(255,180,72,.22),
        rgba(56,232,255,.0)
      );
      filter: blur(14px);
      opacity:.85;
      z-index:-1;
      pointer-events:none;
      animation: glowSpin 6.5s linear infinite;
    }
    @keyframes glowSpin{ 0%{transform: rotate(0deg)} 100%{transform: rotate(360deg)} }

    .neon-text{
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-weight: 900;
      letter-spacing: 2px;
      font-size: 18px;
      text-transform: uppercase;
      color: #fff;
      text-shadow:
        0 0 6px rgba(56,232,255,.85),
        0 0 16px rgba(56,232,255,.55),
        0 0 28px rgba(255,79,216,.40),
        0 0 48px rgba(255,79,216,.25);
      animation: flicker 3.2s infinite;
      user-select:none;
    }
    .neon-sub{
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: 12px;
      font-weight:700;
      color: rgba(255,255,255,.75);
      margin-top:10px;
      letter-spacing:1px;
      text-shadow: 0 0 10px rgba(255,180,72,.25);
      user-select:none;
    }
    @keyframes flicker{
      0%, 19%, 22%, 62%, 64%, 70%, 100% { opacity: 1; filter: brightness(1); }
      20%, 63%, 69% { opacity: .85; filter: brightness(1.15); }
      21% { opacity: .75; }
    }

    /* NEON DERECHO (JP) */
    .neon-sign-right{
      position:fixed;
      right: 16px;
      top: 120px;
      z-index:3;
      display:flex;
      align-items:center;
      justify-content:center;
      width:84px;
      padding:14px 10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(10,14,40,.55), rgba(8,10,26,.35));
      backdrop-filter: blur(10px);
      box-shadow:
        0 16px 70px rgba(0,0,0,.55),
        0 0 26px rgba(255,182,72,.22),
        0 0 44px rgba(255,182,72,.18);
    }
    .neon-sign-right::before{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius: 22px;
      background: conic-gradient(from 180deg,
        rgba(255,182,72,.0),
        rgba(255,182,72,.45),
        rgba(255,255,140,.30),
        rgba(255,182,72,.0)
      );
      filter: blur(14px);
      opacity:.9;
      z-index:-1;
      pointer-events:none;
      animation: glowSpin 7.2s linear infinite reverse;
    }
    .jp-text{
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-weight: 950;
      letter-spacing: 1px;
      font-size: 20px;
      color: #ffe36a;
      text-shadow:
        0 0 6px rgba(255,227,106,.95),
        0 0 18px rgba(255,182,72,.65),
        0 0 34px rgba(255,182,72,.35);
      user-select:none;
      animation: flickerY 2.9s infinite;
    }
    @keyframes flickerY{
      0%, 18%, 21%, 60%, 100% { opacity: 1; filter: brightness(1); }
      19%, 61% { opacity: .85; filter: brightness(1.1); }
      20% { opacity: .7; }
    }

    /* En m√≥vil: neones a barra */
    @media (max-width: 980px){
      .neon-sign, .neon-sign-right{
        position: sticky;
        top: 10px;
        left: auto;
        right: auto;
        margin: 0 0 12px;
        width: 100%;
        flex-direction:row;
        gap:12px;
      }
      .neon-text,.neon-sub,.jp-text{ writing-mode: horizontal-tb; }
    }

    .card{
      position:relative;
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background: var(--card);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding: 28px;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(91,124,250,.20), transparent 55%),
        radial-gradient(800px 500px at 90% 15%, rgba(255,79,216,.12), transparent 58%),
        radial-gradient(600px 550px at 75% 95%, rgba(56,232,255,.10), transparent 55%);
      pointer-events:none;
      z-index:0;
    }
    .card > *{ position:relative; z-index:1; }

    h1{ margin:0 0 8px; font-size: 44px; letter-spacing:.2px; }
    .subtitle{ margin:0 0 22px; color:var(--muted); max-width: 860px; font-size: 18px; line-height:1.4; }

    .grid{
      display:grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 960px){ .grid{grid-template-columns:1fr} }

    .field label{
      display:block;
      font-weight:900;
      margin: 10px 0 10px;
      font-size: 18px;
    }
    .hint{ margin-top:10px; color: var(--muted2); font-size: 14px; line-height:1.35; }

    select, input[type="number"], input[type="text"]{
      width:100%;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(4,7,22,.55);
      color:var(--text);
      padding:14px 14px;
      font-size: 16px;
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    select:focus, input:focus{
      border-color: rgba(91,124,250,.60);
      box-shadow: 0 0 0 3px rgba(91,124,250,.20);
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:18px;
      margin-top: 8px;
    }
    @media (max-width: 960px){ .row2{grid-template-columns:1fr} }

    /* Modos */
    .modes{
      display:flex;
      flex-wrap:nowrap;
      gap:12px;
      overflow:auto;
      padding: 14px 2px 10px;
      margin-top: 12px;
    }
    .mode{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(6,8,22,.45);
      cursor:pointer;
      user-select:none;
      transition: .15s transform, .15s border-color, .15s box-shadow;
      white-space:nowrap;
      font-weight:900;
      color: rgba(255,255,255,.9);
    }
    .mode:hover{ transform: translateY(-1px); }
    .mode input{ width:18px; height:18px; cursor:pointer; }
    .mode.active{
      border-color: rgba(56,232,255,.55);
      box-shadow: 0 0 0 3px rgba(56,232,255,.14);
    }

    .panel{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      background: rgba(10,14,40,.25);
      padding: 14px;
      display:none;
    }

    .panel h3{
      margin: 0 0 10px;
      font-size: 16px;
      letter-spacing:.2px;
    }

    .cta{
      margin-top: 16px;
      width:100%;
      border:0;
      border-radius: 999px;
      padding: 18px 18px;
      font-size: 18px;
      font-weight: 950;
      letter-spacing:.3px;
      color: #fff;
      cursor:pointer;
      background: linear-gradient(90deg, rgba(91,124,250,1), rgba(255,79,216,1));
      box-shadow: 0 18px 70px rgba(91,124,250,.22), 0 18px 70px rgba(255,79,216,.16);
      transition: .15s transform, .15s filter;
    }
    .cta:hover{ transform: translateY(-1px); filter: brightness(1.05); }

    .results{
      margin-top:18px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      background: rgba(10,14,40,.35);
      padding: 18px;
      display:none;
    }
    .results h2{ margin:0 0 10px; font-size: 22px; }
    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 960px){ .kpi{grid-template-columns:1fr} }
    .kpi .box{
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(4,7,22,.45);
    }
    .box .big{
      font-size: 26px;
      font-weight: 950;
      letter-spacing:.2px;
      margin: 0 0 4px;
    }
    .box .small{
      margin:0;
      color: var(--muted2);
      font-size: 13px;
      line-height:1.3;
    }

    .sports{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 960px){ .sports{grid-template-columns:1fr} }
    .sportRow{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(4,7,22,.40);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .sportRow b{font-weight:950}
    .sportRow span{color:var(--muted2); font-size:13px}

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 14px 0;
    }

    .fineprint{
      margin-top: 12px;
      color: var(--muted2);
      font-size: 13px;
      line-height:1.35;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btnLite{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(4,7,22,.45);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight:900;
    }
    .btnLite:hover{ box-shadow: 0 0 0 3px rgba(91,124,250,.16); }

    .memeWrap{
      margin-top: 14px;
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      display:none;
    }
    canvas{display:block; width:100%; height:auto;}

    .friends{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 960px){ .friends{grid-template-columns:1fr} }
    .friendCard{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(4,7,22,.40);
      border-radius: 16px;
      padding: 12px;
    }
    .friendCard h4{margin:0 0 10px; font-size:14px}
    .friendRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .langBtns button{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,14,40,.55);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:950;
    }
    .langBtns button.active{
      box-shadow:0 0 0 3px rgba(91,124,250,.16);
      border-color: rgba(91,124,250,.5);
    }

    /* Seguridad anti ‚Äúno funciona nada‚Äù */
    .card, .field, select, input, button, label { pointer-events:auto; }
  </style>
</head>

<body>
  <div class="fx" aria-hidden="true"></div>

  <!-- NE√ìN IZQUIERDO -->
  <div class="neon-sign" aria-hidden="true" title="Lo vas a sudar">
    <div>
      <div class="neon-text">LO VAS A SUDAR</div>
      <div class="neon-sub">CALOR√çAS</div>
    </div>
  </div>

  <!-- NE√ìN DERECHO (JAPON√âS) -->
  <div class="neon-sign-right" aria-hidden="true" title="„Éè„É≥„Éê„Éº„Ç¨„Éº„Å®ÂØøÂè∏">
    <div class="jp-text">„Éè„É≥„Éê„Éº„Ç¨„Éº„Å®ÂØøÂè∏</div>
  </div>

  <div class="wrap">
    <header>
      <div class="brand-pill" id="brand">LoVasASudar.com ¬∑ Calculadora de castigo cal√≥rico</div>

      <div class="langBtns" style="display:flex; gap:10px;">
        <button id="btnES" type="button" class="active">ES</button>
        <button id="btnEN" type="button">EN</button>
      </div>
    </header>

    <main class="card">
      <h1 id="title">LoVasASudar.com</h1>
      <p class="subtitle" id="subtitle">
        Mete lo que vas a comer y beber y descubre cu√°nto ejercicio tendr√≠as que hacer para sudarlo. Perfecta para cenas con amigos y noches de copas.
      </p>

      <section class="grid" aria-label="Formulario de c√°lculo">
        <div class="field">
          <label for="food" id="lblFood">Alimento o bebida</label>

          <select id="food" aria-label="Alimento o bebida">
            <optgroup label="üçï Comida">
              <option value="850" data-label="Pizza mediana">Pizza mediana (~850 kcal)</option>
              <option value="650" data-label="Hamburguesa">Hamburguesa (~650 kcal)</option>
              <option value="1050" data-label="Kebab completo">Kebab completo (~1050 kcal)</option>
              <option value="520" data-label="Raci√≥n bravas">Raci√≥n bravas (~520 kcal)</option>
              <option value="460" data-label="Bocata calamares">Bocata calamares (~460 kcal)</option>
              <option value="500" data-label="Happy Meal McDonald's">Happy Meal McDonald's (~500 kcal)</option>
              <option value="550" data-label="Big Mac">Big Mac (~550 kcal)</option>
              <option value="510" data-label="Men√∫ mediano McDonald's">Men√∫ mediano McDonald's (~510 kcal)</option>
              <option value="250" data-label="6 Nuggets McDonald's">6 Nuggets McDonald's (~250 kcal)</option>
              <option value="340" data-label="Patatas fritas medianas McDonald's">Patatas medianas McDonald's (~340 kcal)</option>
              <option value="420" data-label="Patatas gajo Burger King">Patatas gajo Burger King (~420 kcal)</option>
              <option value="450" data-label="Porci√≥n pizza queso (1/8 mediana)">Porci√≥n pizza queso (1/8 pizza mediana ~450 kcal)</option>
              <option value="500" data-label="Porci√≥n pizza pepperoni (1/8 mediana)">Porci√≥n pizza pepperoni (1/8 pizza mediana ~500 kcal)</option>
              <option value="3600" data-label="Pizza familiar queso entera">Pizza familiar queso entera (~3600 kcal aprox.)</option>
              <option value="4000" data-label="Pizza familiar pepperoni entera">Pizza familiar pepperoni entera (~4000 kcal aprox.)</option>
              <option value="600" data-label="Lasa√±a bolo√±esa">Lasa√±a bolo√±esa (~600 kcal)</option>
              <option value="700" data-label="Raci√≥n pasta carbonara">Raci√≥n pasta carbonara (~700 kcal)</option>

              <option value="250" data-label="Pincho de tortilla">Pincho de tortilla (~250 kcal)</option>
              <option value="500" data-label="Raci√≥n patatas bravas">Raci√≥n patatas bravas (~500 kcal)</option>
              <option value="350" data-label="3 croquetas de jam√≥n">3 croquetas de jam√≥n (~350 kcal)</option>
              <option value="450" data-label="Bocadillo de jam√≥n serrano">Bocadillo de jam√≥n serrano (~450 kcal)</option>
              <option value="550" data-label="Bocadillo de calamares">Bocadillo de calamares (~550 kcal)</option>

              <option value="280" data-label="Donut cl√°sico">Donut cl√°sico (~280 kcal)</option>
              <option value="220" data-label="Croissant de mantequilla">Croissant de mantequilla (~220 kcal)</option>
              <option value="400" data-label="Palmera de chocolate">Palmera de chocolate (~400 kcal)</option>
              <option value="450" data-label="Brownie de chocolate">Brownie de chocolate (~450 kcal)</option>
              <option value="450" data-label="Muffin de chocolate">Muffin de chocolate (~450 kcal)</option>
              <option value="550" data-label="Tarta de queso porci√≥n">Tarta de queso porci√≥n (~550 kcal)</option>
              <option value="500" data-label="Tarta de chocolate porci√≥n">Tarta de chocolate porci√≥n (~500 kcal)</option>

              <option value="150" data-label="Barrita chocolate tipo KitKat">Barrita chocolate tipo KitKat (~150 kcal)</option>
              <option value="240" data-label="Barrita Snickers">Barrita Snickers (~240 kcal)</option>
              <option value="250" data-label="Bolsa patatas fritas peque√±a">Patatas fritas bolsa peque√±a (~250 kcal)</option>
              <option value="500" data-label="Bolsa patatas fritas grande">Patatas fritas bolsa grande (~500 kcal)</option>
              <option value="200" data-label="Kinder Bueno (2 barritas)">Kinder Bueno (2 barritas) (~200 kcal)</option>
              <option value="200" data-label="Helado de palo cremoso">Helado de palo cremoso (~200 kcal)</option>
              <option value="280" data-label="Helado tipo Magnum">Helado tipo Magnum (~280 kcal)</option>

              <option value="650" data-label="Hamburguesa casera completa">Hamburguesa casera completa (~650 kcal)</option>
              <option value="350" data-label="Raci√≥n de sushi (8 piezas)">Raci√≥n de sushi (8 piezas) (~350 kcal)</option>
              <option value="300" data-label="Ensalada C√©sar completa">Ensalada C√©sar completa (~300 kcal)</option>

              <option value="custom" data-label="Personalizado">Otro / none</option>
              <option value="850" data-label="Kebab completo con todo">Kebab completo (~850 kcal)</option>
              <option value="950" data-label="Shawarma grande extra salsas">Shawarma grande (~950 kcal)</option>
              <option value="700" data-label="Nachos con queso y guacamole">Nachos loaded (~700 kcal)</option>
              <option value="600" data-label="10 alitas barbacoa">10 alitas barbacoa (~600 kcal)</option>
              <option value="450" data-label="Ramen tonkotsu grande">Ramen grande (~450-800 kcal)</option>
              <option value="1200" data-label="Sushi para 2 (20-24 piezas)">Sushi para 2 (~1200 kcal)</option>
              <option value="180" data-label="Sangr√≠a jarra 1L">Sangr√≠a jarra peque√±a (~180-250 kcal/vaso)</option>
              <option value="320" data-label="Cubo cerveza 6 botellines">Cubo cerveza (~320 kcal/vaso)</option>
              <option value="900" data-label="Hamburguesa doble bacon cheese">Doble bacon cheese (~900 kcal)</option>
            </optgroup>

            <optgroup label="üç∫ Bebida">
              <option value="150" data-label="Cerveza 330 ml">Cerveza 330 ml (~150 kcal)</option>
              <option value="180" data-label="Cerveza artesana 330 ml">Cerveza artesana 330 ml (~180 kcal)</option>
              <option value="90" data-label="Copa vino tinto">Copa vino tinto (~90 kcal)</option>
              <option value="110" data-label="Copa vino blanco">Copa vino blanco (~110 kcal)</option>
              <option value="210" data-label="Gin-tonic">Gin-tonic (~210 kcal)</option>
              <option value="200" data-label="Ron-cola">Ron-cola (~200 kcal)</option>
              <option value="240" data-label="Mojito">Mojito (~240 kcal)</option>
              <option value="230" data-label="Sex on the Beach">Sex on the Beach (~230 kcal)</option>
              <option value="250" data-label="Caipiri√±a">Caipiri√±a (~250 kcal)</option>
              <option value="300" data-label="Pi√±a colada">Pi√±a colada (~300 kcal)</option>
              <option value="200" data-label="Whisky-cola">Whisky-cola (~200 kcal)</option>
              <option value="200" data-label="Aperol Spritz">Aperol Spritz (~200 kcal)</option>
              <option value="65" data-label="Chupito tequila">Chupito de tequila (~65 kcal)</option>
              <option value="120" data-label="Refresco azucarado 330 ml">Refresco azucarado 330 ml (~120 kcal)</option>
              <option value="100" data-label="Verm√∫">Verm√∫ (~100 kcal)</option>
            </optgroup>
          </select>

          <div class="row2">
            <div class="field">
              <label for="units" id="lblUnits">N¬∫ de unidades</label>
              <input id="units" type="number" min="1" step="1" value="1" />
              <div class="hint" id="hintUnits">Ej: 3 cervezas ‚Üí pon 3 unidades.</div>
            </div>

            <div class="field">
              <label for="extra" id="lblExtra">Calor√≠as extra</label>
              <input id="extra" type="number" min="0" step="10" value="0" />
              <div class="hint" id="hintExtra">Se suman a lo anterior (comida + copas).</div>
            </div>
          </div>
        </div>

        <div class="field">
          <label for="weight" id="lblWeight">Peso (kg)</label>
          <input id="weight" type="number" min="35" max="200" step="1" value="80" />
          <div class="hint" id="hintWeight">
            El c√°lculo se hace por kg de peso (ecuaci√≥n basada en MET).
          </div>
        </div>

        <div class="field">
          <label for="gender" id="lblGender">G√©nero (opcional)</label>
          <select id="gender">
            <option value="na">Prefiero no decirlo</option>
            <option value="male">Hombre</option>
            <option value="female">Mujer</option>
          </select>
          <div class="hint" id="hintGender">
            Ajuste aproximado (~5%). No es magia, es estad√≠stica con resaca.
          </div>
        </div>
      </section>

      <!-- MODOS EXCLUYENTES -->
      <div class="modes" aria-label="Modos">
        <label class="mode" id="mNormal">
          <input type="radio" name="mode" value="normal" checked />
          <span id="tNormal">Modo normal</span>
        </label>

        <label class="mode" id="mDrinks">
          <input type="radio" name="mode" value="drinks" />
          <span id="tDrinks">Modo noche de copas</span>
        </label>

        <label class="mode" id="mBattle">
          <input type="radio" name="mode" value="battle" />
          <span id="tBattle">Batalla de colegas</span>
        </label>

        <label class="mode" id="mInverse">
          <input type="radio" name="mode" value="inverse" />
          <span id="tInverse">Calculadora inversa</span>
        </label>
      </div>

      <!-- PANEL: NOCHE DE COPAS -->
      <div class="panel" id="panelDrinks">
        <h3 id="drinksTitle">üçª A√±ade tus bebidas (se suman al total)</h3>

        <div class="row2">
          <div class="field">
            <label for="drink1" id="lblDrink1">Bebida</label>
            <select id="drink1"></select>
          </div>
          <div class="field">
            <label for="drink1n" id="lblDrink1n">Cantidad</label>
            <input id="drink1n" type="number" min="0" step="1" value="0" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label for="drink2" id="lblDrink2">Bebida (opcional)</label>
            <select id="drink2"></select>
          </div>
          <div class="field">
            <label for="drink2n" id="lblDrink2n">Cantidad</label>
            <input id="drink2n" type="number" min="0" step="1" value="0" />
          </div>
        </div>

        <div class="row2">
          <div class="field">
            <label for="drink3" id="lblDrink3">Bebida (opcional)</label>
            <select id="drink3"></select>
          </div>
          <div class="field">
            <label for="drink3n" id="lblDrink3n">Cantidad</label>
            <input id="drink3n" type="number" min="0" step="1" value="0" />
          </div>
        </div>

        <div class="hint" id="drinksHint">
          Tip: si mezclas ‚Äúcubo cerveza‚Äù + ‚Äúgin-tonic‚Äù, el universo no juzga‚Ä¶ pero las matem√°ticas s√≠.
        </div>
      </div>

      <!-- PANEL: BATALLA -->
      <div class="panel" id="panelBattle">
        <h3 id="battleTitle">‚öîÔ∏è Batalla de colegas (t√∫ + 3)</h3>
        <div class="friends">
          <div class="friendCard">
            <h4 id="youTitle">T√∫</h4>
            <div class="friendRow">
              <input id="p1name" type="text" placeholder="Nombre (opcional)" />
              <select id="p1gender">
                <option value="na">Prefiero no decirlo</option>
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
              </select>
            </div>
            <div style="margin-top:10px;">
              <input id="p1w" type="number" min="35" max="200" step="1" value="80" />
              <div class="hint" id="battleHint1">Peso (kg)</div>
            </div>
          </div>

          <div class="friendCard">
            <h4>Colega 1</h4>
            <div class="friendRow">
              <input id="p2name" type="text" placeholder="Nombre" />
              <select id="p2gender">
                <option value="na">Prefiero no decirlo</option>
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
              </select>
            </div>
            <div style="margin-top:10px;">
              <input id="p2w" type="number" min="35" max="200" step="1" value="75" />
              <div class="hint">Peso (kg)</div>
            </div>
          </div>

          <div class="friendCard">
            <h4>Colega 2</h4>
            <div class="friendRow">
              <input id="p3name" type="text" placeholder="Nombre" />
              <select id="p3gender">
                <option value="na">Prefiero no decirlo</option>
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
              </select>
            </div>
            <div style="margin-top:10px;">
              <input id="p3w" type="number" min="35" max="200" step="1" value="68" />
              <div class="hint">Peso (kg)</div>
            </div>
          </div>

          <div class="friendCard">
            <h4>Colega 3</h4>
            <div class="friendRow">
              <input id="p4name" type="text" placeholder="Nombre" />
              <select id="p4gender">
                <option value="na">Prefiero no decirlo</option>
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
              </select>
            </div>
            <div style="margin-top:10px;">
              <input id="p4w" type="number" min="35" max="200" step="1" value="90" />
              <div class="hint">Peso (kg)</div>
            </div>
          </div>
        </div>

        <div class="hint" id="battleHint2" style="margin-top:10px;">
          Aqu√≠ no gana el m√°s fuerte. Gana el que tiene menos calor√≠as‚Ä¶ o m√°s dignidad.
        </div>
      </div>

      <!-- PANEL: INVERSA -->
      <div class="panel" id="panelInverse">
        <h3 id="inverseTitle">üîÅ Calculadora inversa</h3>
        <div class="row2">
          <div class="field">
            <label for="invSport" id="lblInvSport">Deporte</label>
            <select id="invSport"></select>
          </div>
          <div class="field">
            <label for="invHours" id="lblInvHours">Duraci√≥n (horas)</label>
            <input id="invHours" type="number" min="0" step="0.25" value="1" />
            <div class="hint" id="invHint">Ej: 1.5 = 1 hora y 30 min</div>
          </div>
        </div>
      </div>

      <button class="cta" id="btnCalc" type="button">CALCULAR EJERCICIO NECESARIO üí™</button>

      <section class="results" id="results" aria-label="Resultados">
        <h2 id="resTitle">üéØ Resultados</h2>

        <div class="kpi" id="kpiBlock">
          <div class="box">
            <p class="big" id="kcalOut">0 kcal</p>
            <p class="small" id="kcalSub">Calor√≠as totales estimadas</p>
          </div>
          <div class="box">
            <p class="big" id="modeOut">Normal</p>
            <p class="small" id="modeSub">Modo activo</p>
          </div>
          <div class="box">
            <p class="big" id="mainOut">‚Äî</p>
            <p class="small" id="mainSub">Resumen</p>
          </div>
        </div>

        <div class="divider"></div>

        <div id="sportsTitle" style="font-weight:950; margin-bottom:8px;">‚è±Ô∏è Tiempo para quemarlo (aprox.)</div>
        <div class="sports" id="sportsList"></div>

        <div id="battleResultsWrap" style="display:none;">
          <div class="divider"></div>
          <div style="font-weight:950; margin-bottom:8px;" id="battleResultsTitle">‚öîÔ∏è Resultado por persona</div>
          <div class="sports" id="battleList"></div>
        </div>

        <div id="inverseResultsWrap" style="display:none;">
          <div class="divider"></div>
          <div style="font-weight:950; margin-bottom:8px;" id="inverseResultsTitle">üîÅ Has ‚Äúganado‚Äù esto</div>
          <div class="sports" id="inverseList"></div>
        </div>

        <div class="btnRow">
          <button class="btnLite" id="btnMeme">üì∏ Generar MEME</button>
          <a class="btnLite" id="btnDownload" download="lovasasudar-meme.png" href="#" style="display:none; text-decoration:none;">‚¨áÔ∏è Descargar MEME</a>
          <button class="btnLite" id="btnShare" style="display:none;">üì≤ Compartir</button>
        </div>

        <div class="memeWrap" id="memeWrap">
          <canvas id="memeCanvas" width="1200" height="630"></canvas>
        </div>

        <div class="fineprint" id="fineprint">
          Estimaciones aproximadas basadas en MET (la f√≠sica no negocia, pero s√≠ te deja elegir dardos).
        </div>
      </section>
    </main>
  </div>

  <script>
    // =========================
    // i18n
    // =========================
    let LANG = "es";

    const T = {
      es:{
        brand:"LoVasASudar.com ¬∑ Calculadora de castigo cal√≥rico",
        title:"LoVasASudar.com",
        subtitle:"Mete lo que vas a comer y beber y descubre cu√°nto ejercicio tendr√≠as que hacer para sudarlo. Perfecta para cenas con amigos y noches de copas.",
        lblFood:"Alimento o bebida",
        lblUnits:"N¬∫ de unidades",
        hintUnits:"Ej: 3 cervezas ‚Üí pon 3 unidades.",
        lblExtra:"Calor√≠as extra",
        hintExtra:"Se suman a lo anterior (comida + copas).",
        lblWeight:"Peso (kg)",
        hintWeight:"El c√°lculo se hace por kg de peso (ecuaci√≥n basada en MET).",
        lblGender:"G√©nero (opcional)",
        hintGender:"Ajuste aproximado (~5%). No es magia, es estad√≠stica con resaca.",
        modes:{
          normal:"Modo normal",
          drinks:"Modo noche de copas",
          battle:"Batalla de colegas",
          inverse:"Calculadora inversa"
        },
        btnCalc:"CALCULAR EJERCICIO NECESARIO üí™",
        results:"üéØ Resultados",
        kcalSub:"Calor√≠as totales estimadas",
        modeSub:"Modo activo",
        sportsTitle:"‚è±Ô∏è Tiempo para quemarlo (aprox.)",
        meme:"üì∏ Generar MEME",
        download:"‚¨áÔ∏è Descargar MEME",
        share:"üì≤ Compartir",
        fine:"Estimaciones aproximadas basadas en MET (la f√≠sica no negocia, pero s√≠ te deja elegir dardos).",
        drinksTitle:"üçª A√±ade tus bebidas (se suman al total)",
        drinksHint:"Tip: si mezclas ‚Äúcubo cerveza‚Äù + ‚Äúgin-tonic‚Äù, el universo no juzga‚Ä¶ pero las matem√°ticas s√≠.",
        battleTitle:"‚öîÔ∏è Batalla de colegas (t√∫ + 3)",
        youTitle:"T√∫",
        battleHint2:"Aqu√≠ no gana el m√°s fuerte. Gana el que tiene menos calor√≠as‚Ä¶ o m√°s dignidad.",
        inverseTitle:"üîÅ Calculadora inversa",
        invSport:"Deporte",
        invHours:"Duraci√≥n (horas)",
        invHint:"Ej: 1.5 = 1 hora y 30 min",
        battleResultsTitle:"‚öîÔ∏è Resultado por persona",
        inverseResultsTitle:"üîÅ Has ‚Äúganado‚Äù esto",
        modeNames:{ normal:"Normal", drinks:"Noche de copas", battle:"Batalla", inverse:"Inversa" },
        summaryNormal:(k)=>`Castigo: ${k} kcal. El universo te mira.`,
        summaryBattle:(k)=>`Todos al barro: ${k} kcal por cabeza.`,
        summaryInverse:(k)=>`Has generado ${k} kcal de ‚Äúpresupuesto comestible‚Äù.`,
      },
      en:{
        brand:"LoVasASudar.com ¬∑ Calorie payback calculator",
        title:"LoVasASudar.com",
        subtitle:"Add what you‚Äôll eat and drink and see how much exercise you‚Äôd need to sweat it off. Perfect for dinners with friends and nights out.",
        lblFood:"Food or drink",
        lblUnits:"Units",
        hintUnits:"Ex: 3 beers ‚Üí enter 3 units.",
        lblExtra:"Extra calories",
        hintExtra:"Added to the above (food + drinks).",
        lblWeight:"Weight (kg)",
        hintWeight:"Calculated per kg (MET-based equation).",
        lblGender:"Gender (optional)",
        hintGender:"Rough ~5% adjustment. Not magic. Just biology being annoying.",
        modes:{
          normal:"Normal mode",
          drinks:"Night-out mode",
          battle:"Friends battle",
          inverse:"Inverse calculator"
        },
        btnCalc:"CALCULATE REQUIRED EXERCISE üí™",
        results:"üéØ Results",
        kcalSub:"Estimated total calories",
        modeSub:"Active mode",
        sportsTitle:"‚è±Ô∏è Time to burn it (roughly)",
        meme:"üì∏ Generate MEME",
        download:"‚¨áÔ∏è Download MEME",
        share:"üì≤ Share",
        fine:"Rough estimates based on MET (physics keeps receipts, but it lets you pick darts).",
        drinksTitle:"üçª Add your drinks (they‚Äôre added to the total)",
        drinksHint:"Tip: mixing ‚Äòbeer bucket‚Äô + ‚Äògin & tonic‚Äô is allowed. Math will still snitch.",
        battleTitle:"‚öîÔ∏è Friends battle (you + 3)",
        youTitle:"You",
        battleHint2:"This isn‚Äôt won by the strongest. It‚Äôs won by the least calories‚Ä¶ or the most dignity.",
        inverseTitle:"üîÅ Inverse calculator",
        invSport:"Sport",
        invHours:"Duration (hours)",
        invHint:"Ex: 1.5 = 1 hour 30 min",
        battleResultsTitle:"‚öîÔ∏è Result per person",
        inverseResultsTitle:"üîÅ You‚Äôve ‚Äòearned‚Äô this",
        modeNames:{ normal:"Normal", drinks:"Night-out", battle:"Battle", inverse:"Inverse" },
        summaryNormal:(k)=>`Payback: ${k} kcal. The universe is watching.`,
        summaryBattle:(k)=>`Everyone pays: ${k} kcal each.`,
        summaryInverse:(k)=>`You created a ${k} kcal ‚Äúedible budget‚Äù.`,
      }
    };

    // =========================
    // Helpers
    // =========================
    const $ = (id)=>document.getElementById(id);

    // kcal/min = (MET * 3.5 * weightKg) / 200
    function kcalPerMinute(met, weightKg){
      return (met * 3.5 * weightKg) / 200;
    }
    function clamp(n,a,b){ return Math.min(b, Math.max(a,n)); }
    function round(n){ return Math.round(n); }

    const GENDER_FACTOR = { na:1.00, male:1.00, female:0.95 };

    // =========================
    // Sports list (MET approximate)
    // Incluye frikadas: petanca, dardos, bolos
    // =========================
    const SPORTS = [
      { key:"run",    es:"Correr suave",         en:"Easy run",            met:8.0 },
      { key:"walk",   es:"Caminar r√°pido",       en:"Brisk walk",          met:4.3 },
      { key:"bike",   es:"Bici moderada",        en:"Cycling moderate",    met:6.8 },
      { key:"swim",   es:"Nataci√≥n",             en:"Swimming",            met:6.0 },
      { key:"hiit",   es:"HIIT",                 en:"HIIT",                met:9.0 },
      { key:"weights",es:"Pesas",                en:"Weight training",     met:5.0 },
      { key:"football",es:"F√∫tbol",              en:"Soccer",              met:7.0 },
      { key:"dance",  es:"Bailar",               en:"Dancing",             met:5.5 },
      { key:"stairs", es:"Subir escaleras",      en:"Stairs",              met:8.8 },
      { key:"yoga",   es:"Yoga",                 en:"Yoga",                met:2.5 },
      { key:"bowling",es:"Bolos",                en:"Bowling",             met:3.0 },
      { key:"darts",  es:"Dardos",               en:"Darts",               met:2.5 },
      { key:"petanque",es:"Petanca",             en:"Bocce / Petanque",    met:3.0 },
    ];

    // =========================
    // Drinks selector: lo rellenamos con opciones de "üç∫ Bebida" existentes
    // =========================
    function extractDrinkOptions(){
      const foodSelect = $("food");
      const groups = [...foodSelect.querySelectorAll("optgroup")];
      const drinkGroup = groups.find(g => (g.label || "").includes("Bebida"));
      if (!drinkGroup) return [];
      return [...drinkGroup.querySelectorAll("option")]
        .filter(o => o.value && o.value !== "custom")
        .map(o => ({ value: o.value, label: o.getAttribute("data-label") || o.textContent.trim() }));
    }

    function fillDrinkSelects(){
      const opts = extractDrinkOptions();
      const ids = ["drink1","drink2","drink3"];
      ids.forEach(id=>{
        const sel = $(id);
        sel.innerHTML = "";
        opts.forEach(o=>{
          const opt = document.createElement("option");
          opt.value = o.value;
          opt.textContent = o.label;
          sel.appendChild(opt);
        });
      });
    }

    function fillInverseSports(){
      const sel = $("invSport");
      sel.innerHTML = "";
      SPORTS.forEach(s=>{
        const opt = document.createElement("option");
        opt.value = s.key;
        opt.textContent = (LANG==="es" ? s.es : s.en);
        sel.appendChild(opt);
      });
      sel.value = "run";
    }

    function getSelectedMode(){
      const r = document.querySelector('input[name="mode"]:checked');
      return r ? r.value : "normal";
    }
    function syncModePills(){
      document.querySelectorAll(".mode").forEach(l => l.classList.remove("active"));
      const selected = document.querySelector('input[name="mode"]:checked');
      if (selected) selected.closest(".mode").classList.add("active");

      // Panels
      $("panelDrinks").style.display  = (getSelectedMode()==="drinks") ? "block" : "none";
      $("panelBattle").style.display  = (getSelectedMode()==="battle") ? "block" : "none";
      $("panelInverse").style.display = (getSelectedMode()==="inverse") ? "block" : "none";

      // Bot√≥n texto
      $("btnCalc").textContent = T[LANG].btnCalc;
    }

    function getBaseCalories(){
      const sel = $("food");
      const v = sel.value;
      if (v === "custom") return 0;
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : 0;
    }

    function getSelectedLabel(){
      const opt = $("food").selectedOptions[0];
      return opt ? (opt.getAttribute("data-label") || opt.textContent.trim()) : "";
    }

    function getTotalCaloriesWithMode(){
      const units = Math.max(1, parseInt($("units").value || "1", 10));
      const extra = Math.max(0, parseInt($("extra").value || "0", 10));
      let kcal = getBaseCalories() * units + extra;

      const mode = getSelectedMode();
      if (mode === "drinks"){
        // suma bebidas extra (cada una con su cantidad)
        const d1 = parseFloat($("drink1").value || "0") * Math.max(0, parseInt($("drink1n").value || "0",10));
        const d2 = parseFloat($("drink2").value || "0") * Math.max(0, parseInt($("drink2n").value || "0",10));
        const d3 = parseFloat($("drink3").value || "0") * Math.max(0, parseInt($("drink3n").value || "0",10));
        kcal += (Number.isFinite(d1)?d1:0) + (Number.isFinite(d2)?d2:0) + (Number.isFinite(d3)?d3:0);
      }
      return Math.max(0, Math.round(kcal));
    }

    function minutesNeeded(kcal, sportMet, weightKg, gender){
      const factor = GENDER_FACTOR[gender] ?? 1.0;
      const kpm = kcalPerMinute(sportMet, weightKg) * factor;
      if (kpm <= 0) return Infinity;
      return kcal / kpm;
    }

    function renderSportsTable(kcal, weight, gender){
      const list = $("sportsList");
      list.innerHTML = "";
      SPORTS.forEach(s=>{
        const min = minutesNeeded(kcal, s.met, weight, gender);
        const txtMin = (min===Infinity) ? "‚Äî" : `${Math.round(min)} min`;
        const row = document.createElement("div");
        row.className = "sportRow";
        row.innerHTML = `
          <div>
            <b>${LANG==="es" ? s.es : s.en}</b>
            <div><span>MET ‚âà ${s.met}</span></div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:950; font-size:18px;">${txtMin}</div>
            <div><span>${LANG==="es" ? "para ~" : "to burn ~"}${kcal} kcal</span></div>
          </div>
        `;
        list.appendChild(row);
      });
    }

    function renderBattle(kcal){
      const people = [
        { name: $("p1name").value.trim() || (LANG==="es" ? "T√∫" : "You"), w: parseInt($("p1w").value||"80",10), g: $("p1gender").value },
        { name: $("p2name").value.trim() || (LANG==="es" ? "Colega 1" : "Friend 1"), w: parseInt($("p2w").value||"75",10), g: $("p2gender").value },
        { name: $("p3name").value.trim() || (LANG==="es" ? "Colega 2" : "Friend 2"), w: parseInt($("p3w").value||"68",10), g: $("p3gender").value },
        { name: $("p4name").value.trim() || (LANG==="es" ? "Colega 3" : "Friend 3"), w: parseInt($("p4w").value||"90",10), g: $("p4gender").value },
      ].map(p => ({...p, w: clamp(p.w,35,200)}));

      const mainSport = SPORTS.find(s=>s.key==="run"); // referencia simple (correr)
      const list = $("battleList");
      list.innerHTML = "";

      people.forEach(p=>{
        const minRun = minutesNeeded(kcal, mainSport.met, p.w, p.g);
        const row = document.createElement("div");
        row.className = "sportRow";
        row.innerHTML = `
          <div>
            <b>${escapeHtml(p.name)}</b>
            <div><span>${p.w} kg ¬∑ ${genderLabel(p.g)}</span></div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:950; font-size:18px;">${Math.round(minRun)} min</div>
            <div><span>${LANG==="es" ? "corriendo suave" : "easy run"}</span></div>
          </div>
        `;
        list.appendChild(row);
      });
      $("battleResultsWrap").style.display = "block";
    }

    function renderInverse(weight, gender){
      const sportKey = $("invSport").value;
      const hours = Math.max(0, parseFloat($("invHours").value || "0"));
      const sport = SPORTS.find(s=>s.key===sportKey) || SPORTS[0];
      const factor = GENDER_FACTOR[gender] ?? 1.0;

      const minutes = hours * 60;
      const kpm = kcalPerMinute(sport.met, weight) * factor;
      const burned = Math.max(0, Math.round(kpm * minutes));

      // Ahora ‚Äúqu√© puedo consumir‚Äù: top equivalencias del combo
      const options = [...$("food").querySelectorAll("option")]
        .filter(o => o.value && o.value !== "custom")
        .map(o => ({
          kcal: parseFloat(o.value),
          label: o.getAttribute("data-label") || o.textContent.trim()
        }))
        .filter(x => Number.isFinite(x.kcal) && x.kcal > 0);

      // escogemos 10 items "representativos" (los que mejor encajan por unidades)
      const scored = options.map(it=>{
        const units = burned / it.kcal;
        const score = Math.abs(1 - units); // cerca de 1 unidad es m√°s ‚Äúintuitivo‚Äù
        return { ...it, units, score };
      }).sort((a,b)=>a.score-b.score).slice(0, 10);

      const list = $("inverseList");
      list.innerHTML = "";

      // primer row: resumen kcal
      const head = document.createElement("div");
      head.className = "sportRow";
      head.innerHTML = `
        <div>
          <b>${LANG==="es" ? "Kcal quemadas" : "Calories burned"}</b>
          <div><span>${LANG==="es" ? "Con" : "With"} ${LANG==="es" ? sport.es : sport.en} ¬∑ ${hours.toFixed(2)} h</span></div>
        </div>
        <div style="text-align:right;">
          <div style="font-weight:950; font-size:18px; color:var(--good);">${burned} kcal</div>
          <div><span>${LANG==="es" ? "presupuesto comestible" : "edible budget"}</span></div>
        </div>
      `;
      list.appendChild(head);

      scored.forEach(it=>{
        const u = it.units;
        const uTxt = (u >= 2) ? `${u.toFixed(1)}x` : `${u.toFixed(2)}x`;
        const row = document.createElement("div");
        row.className = "sportRow";
        row.innerHTML = `
          <div>
            <b>${escapeHtml(it.label)}</b>
            <div><span>~${Math.round(it.kcal)} kcal ${LANG==="es" ? "por unidad" : "per unit"}</span></div>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:950; font-size:18px;">${uTxt}</div>
            <div><span>${LANG==="es" ? "unidades aprox." : "units approx."}</span></div>
          </div>
        `;
        list.appendChild(row);
      });

      $("inverseResultsWrap").style.display = "block";
      return burned;
    }

    // =========================
    // Meme generation (Canvas)
    // =========================
    function generateMeme({kcal, modeName, label, weight, sportPick}){
      const wrap = $("memeWrap");
      const canvas = $("memeCanvas");
      const ctx = canvas.getContext("2d");

      // Background
      const w = canvas.width, h = canvas.height;

      // gradient
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "rgba(91,124,250,1)");
      g.addColorStop(1, "rgba(255,79,216,1)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // glow blobs
      ctx.globalAlpha = 0.25;
      blob(ctx, 230, 180, 220, "rgba(56,232,255,1)");
      blob(ctx, 980, 160, 260, "rgba(255,180,72,1)");
      blob(ctx, 820, 540, 300, "rgba(56,232,255,1)");
      ctx.globalAlpha = 1;

      // Card overlay
      roundRect(ctx, 60, 60, w-120, h-120, 34);
      ctx.fillStyle = "rgba(10,14,40,.70)";
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "rgba(255,255,255,.12)";
      ctx.stroke();

      // Title
      ctx.fillStyle = "rgba(255,255,255,.95)";
      ctx.font = "900 56px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("LOVASASUDAR.COM", 100, 150);

      // Subtitle
      ctx.font = "700 30px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(255,255,255,.85)";
      const sub = (LANG==="es")
        ? "Castigo cal√≥rico (oficial y sin abogados)"
        : "Calorie payback (official-ish, lawyers asleep)";
      ctx.fillText(sub, 100, 200);

      // Main numbers
      ctx.font = "950 120px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "#fff";
      ctx.fillText(`${kcal}`, 100, 340);

      ctx.font = "900 44px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(255,255,255,.9)";
      ctx.fillText(LANG==="es" ? "kcal" : "kcal", 430, 340);

      // Details line
      ctx.font = "800 30px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(255,255,255,.85)";
      const d1 = (LANG==="es")
        ? `Modo: ${modeName} ¬∑ Peso: ${weight}kg`
        : `Mode: ${modeName} ¬∑ Weight: ${weight}kg`;
      ctx.fillText(d1, 100, 410);

      // Item
      ctx.font = "800 30px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      const d2 = (LANG==="es")
        ? `Comida/bebida: ${label || "misterio comestible"}`
        : `Item: ${label || "mysterious edible object"}`;
      ctx.fillText(trimTo(ctx, d2, w-200), 100, 455);

      // Sport suggestion
      ctx.font = "900 38px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(255,227,106,.95)";
      const d3 = (LANG==="es")
        ? `Soluci√≥n: ${sportPick}`
        : `Solution: ${sportPick}`;
      ctx.fillText(trimTo(ctx, d3, w-200), 100, 520);

      // footer
      ctx.font = "800 24px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "rgba(255,255,255,.75)";
      const foot = (LANG==="es")
        ? "Comparte y que el grupo cargue con la culpa."
        : "Share it and let the group carry the guilt.";
      ctx.fillText(foot, 100, 585);

      // Show
      wrap.style.display = "block";

      // Download link
      const url = canvas.toDataURL("image/png");
      const dl = $("btnDownload");
      dl.href = url;
      dl.style.display = "inline-flex";

      // Share (Web Share API)
      const shareBtn = $("btnShare");
      if (navigator.share){
        shareBtn.style.display = "inline-flex";
      } else {
        shareBtn.style.display = "none";
      }

      return url;
    }

    function blob(ctx, x, y, r, color){
      const g = ctx.createRadialGradient(x,y,0,x,y,r);
      g.addColorStop(0, color);
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fill();
    }

    function roundRect(ctx, x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    function trimTo(ctx, text, maxWidth){
      if (ctx.measureText(text).width <= maxWidth) return text;
      let t = text;
      while (t.length > 0 && ctx.measureText(t + "‚Ä¶").width > maxWidth){
        t = t.slice(0, -1);
      }
      return t + "‚Ä¶";
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function genderLabel(g){
      if (LANG==="en"){
        return g==="male" ? "Male" : g==="female" ? "Female" : "NA";
      }
      return g==="male" ? "Hombre" : g==="female" ? "Mujer" : "N/D";
    }

    // =========================
    // Main calculate handler
    // =========================
    function calculate(){
      // reset sections
      $("battleResultsWrap").style.display = "none";
      $("inverseResultsWrap").style.display = "none";
      $("memeWrap").style.display = "none";
      $("btnDownload").style.display = "none";

      const mode = getSelectedMode();
      const modeName = T[LANG].modeNames[mode] || mode;

      const weight = clamp(parseInt($("weight").value||"80",10),35,200);
      const gender = $("gender").value;

      const kcal = getTotalCaloriesWithMode();

      // KPI
      $("kcalOut").textContent = `${kcal} kcal`;
      $("kcalSub").textContent = T[LANG].kcalSub;
      $("modeOut").textContent = modeName;
      $("modeSub").textContent = T[LANG].modeSub;

      let summary = "‚Äî";

      // NORMAL / DRINKS: tabla deportes para el usuario
      if (mode === "normal" || mode === "drinks"){
        renderSportsTable(kcal, weight, gender);
        summary = T[LANG].summaryNormal(kcal);

        $("sportsTitle").textContent = T[LANG].sportsTitle;
      }

      // BATTLE: calculo para cada persona (usamos correr suave como comparador)
      if (mode === "battle"){
        // tabla general tambi√©n (para ‚Äút√∫‚Äù como referencia)
        renderSportsTable(kcal, weight, gender);
        renderBattle(kcal);
        summary = T[LANG].summaryBattle(kcal);
        $("sportsTitle").textContent = T[LANG].sportsTitle;
      }

      // INVERSE: deporte + horas => kcal quemadas; equivalencias
      if (mode === "inverse"){
        // En inversa, NO usamos el combo como ‚Äúlo que comes‚Äù, sino como cat√°logo para equivalencias
        // La ‚Äúkcal‚Äù principal aqu√≠ la calculamos por deporte/duraci√≥n
        const burned = renderInverse(weight, gender);
        $("kcalOut").textContent = `${burned} kcal`;
        $("kcalSub").textContent = (LANG==="es") ? "Kcal quemadas" : "Calories burned";
        // mostramos deportes? no hace falta, dejamos el panel inverso como n√∫cleo
        $("sportsList").innerHTML = "";
        $("sportsTitle").textContent = (LANG==="es") ? "üçΩÔ∏è ¬øQu√© te has ganado?" : "üçΩÔ∏è What did you earn?";
        summary = T[LANG].summaryInverse(burned);
      }

      $("mainOut").textContent = (LANG==="es" ? "OK" : "OK");
      $("mainSub").textContent = summary;

      $("results").style.display = "block";
      $("results").scrollIntoView({ behavior:"smooth", block:"start" });

      // Analytics
      try{
        if (typeof gtag === "function"){
          gtag("event","calculate",{
            mode,
            kcal,
            weight,
            gender,
            item_label: getSelectedLabel()
          });
        }
      }catch(_){}
    }

    // Choose a ‚Äúfun‚Äù sport suggestion for meme: pick one mid-range time (not absurd)
    function pickSportForMeme(kcal, weight, gender){
      const rows = SPORTS.map(s=>{
        const m = minutesNeeded(kcal, s.met, weight, gender);
        return {s, m};
      }).filter(x => isFinite(x.m)).sort((a,b)=>a.m-b.m);

      // pick something not too low and not too high => around median
      const mid = rows[Math.floor(rows.length/2)] || rows[0];
      const name = (LANG==="es" ? mid.s.es : mid.s.en);
      const mins = Math.round(mid.m);
      return `${mins} min de ${name}`;
    }

    // Meme button
    function onMeme(){
      const mode = getSelectedMode();
      const modeName = T[LANG].modeNames[mode] || mode;

      const weight = clamp(parseInt($("weight").value||"80",10),35,200);
      const gender = $("gender").value;

      let kcalForMeme = 0;
      let label = getSelectedLabel();

      if (mode === "inverse"){
        // meme de inversa: kcal quemadas calculadas
        const sportKey = $("invSport").value;
        const hours = Math.max(0, parseFloat($("invHours").value || "0"));
        const sport = SPORTS.find(s=>s.key===sportKey) || SPORTS[0];
        const factor = GENDER_FACTOR[gender] ?? 1.0;
        const burned = Math.round(kcalPerMinute(sport.met, weight) * factor * (hours*60));
        kcalForMeme = burned;
        label = (LANG==="es")
          ? `Ejercicio: ${sport.es} (${hours.toFixed(2)}h)`
          : `Exercise: ${sport.en} (${hours.toFixed(2)}h)`;
      } else {
        kcalForMeme = getTotalCaloriesWithMode();
      }

      const sportPick = (mode === "inverse")
        ? (LANG==="es" ? "A comer con tranquilidad (moderada)" : "Eat with (moderate) peace")
        : pickSportForMeme(kcalForMeme, weight, gender);

      const url = generateMeme({
        kcal: kcalForMeme,
        modeName,
        label,
        weight,
        sportPick
      });

      // Share
      $("btnShare").onclick = async ()=>{
        try{
          // Web Share con archivo: necesita fetch->blob->file
          const blob = await (await fetch(url)).blob();
          const file = new File([blob], "lovasasudar-meme.png", { type: "image/png" });
          await navigator.share({
            title: "LoVasASudar.com",
            text: (LANG==="es" ? "Mira mi castigo cal√≥rico üò≠" : "Look at my calorie payback üò≠"),
            files: [file]
          });
        }catch(e){
          // fallback silencioso
          alert(LANG==="es" ? "No se pudo compartir. Desc√°rgalo y s√∫belo manualmente." : "Couldn‚Äôt share. Download it and upload manually.");
        }
      };
    }

    // =========================
    // Language apply
    // =========================
    function applyLanguage(){
      const t = T[LANG];
      $("brand").textContent = t.brand;
      $("title").textContent = t.title;
      $("subtitle").textContent = t.subtitle;

      $("lblFood").textContent = t.lblFood;
      $("lblUnits").textContent = t.lblUnits;
      $("hintUnits").textContent = t.hintUnits;
      $("lblExtra").textContent = t.lblExtra;
      $("hintExtra").textContent = t.hintExtra;
      $("lblWeight").textContent = t.lblWeight;
      $("hintWeight").textContent = t.hintWeight;
      $("lblGender").textContent = t.lblGender;
      $("hintGender").textContent = t.hintGender;

      $("tNormal").textContent = t.modes.normal;
      $("tDrinks").textContent = t.modes.drinks;
      $("tBattle").textContent = t.modes.battle;
      $("tInverse").textContent = t.modes.inverse;

      $("btnCalc").textContent = t.btnCalc;

      $("resTitle").textContent = t.results;
      $("kcalSub").textContent = t.kcalSub;
      $("modeSub").textContent = t.modeSub;
      $("sportsTitle").textContent = t.sportsTitle;

      $("btnMeme").textContent = t.meme;
      $("btnDownload").textContent = t.download;
      $("btnShare").textContent = t.share;
      $("fineprint").textContent = t.fine;

      $("drinksTitle").textContent = t.drinksTitle;
      $("drinksHint").textContent = t.drinksHint;

      $("battleTitle").textContent = t.battleTitle;
      $("youTitle").textContent = t.youTitle;
      $("battleHint2").textContent = t.battleHint2;

      $("inverseTitle").textContent = t.inverseTitle;
      $("lblInvSport").textContent = t.invSport;
      $("lblInvHours").textContent = t.invHours;
      $("invHint").textContent = t.invHint;

      $("battleResultsTitle").textContent = t.battleResultsTitle;
      $("inverseResultsTitle").textContent = t.inverseResultsTitle;

      // Placeholder names in EN
      if (LANG==="en"){
        $("p1name").placeholder = "Name (optional)";
        $("p2name").placeholder = "Name";
        $("p3name").placeholder = "Name";
        $("p4name").placeholder = "Name";
      } else {
        $("p1name").placeholder = "Nombre (opcional)";
        $("p2name").placeholder = "Nombre";
        $("p3name").placeholder = "Nombre";
        $("p4name").placeholder = "Nombre";
      }

      // Refill sports dropdown labels
      fillInverseSports();
    }

    // =========================
    // Init
    // =========================
    function init(){
      // Language buttons
      $("btnES").addEventListener("click", ()=>{
        LANG = "es";
        $("btnES").classList.add("active");
        $("btnEN").classList.remove("active");
        applyLanguage();
      });
      $("btnEN").addEventListener("click", ()=>{
        LANG = "en";
        $("btnEN").classList.add("active");
        $("btnES").classList.remove("active");
        applyLanguage();
      });

      // Fill drink selects from existing "Bebida" optgroup
      fillDrinkSelects();

      // Fill inverse sports
      fillInverseSports();

      // Mode pills
      document.querySelectorAll('input[name="mode"]').forEach(r=>{
        r.addEventListener("change", syncModePills);
      });
      syncModePills();

      // Button calculate
      $("btnCalc").addEventListener("click", calculate);

      // Meme
      $("btnMeme").addEventListener("click", ()=>{
        // Si no hay resultados, calcula primero
        if ($("results").style.display !== "block") calculate();
        onMeme();
      });

      // Normalize units
      $("units").addEventListener("blur", ()=>{
        const n = Math.max(1, parseInt($("units").value || "1",10));
        $("units").value = String(n);
      });

      // If custom -> focus extra
      $("food").addEventListener("change", ()=>{
        if ($("food").value === "custom") $("extra").focus();
      });

      // Start language ES
      applyLanguage();
    }

    init();
  </script>
</body>
</html>
